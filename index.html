<!DOCTYPE html>
<html>
<head>

    <title>CharityViz</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">

    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/2.8.1/d3.v2.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.0.3/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0.beta6/handlebars.min.js"></script>
    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <script src="js/countrycodes.js"></script>
    <script src="js/sparql/sparql.js"></script>

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="span8 offset2" style="margin-top:40px">
                <h2>Project Widgets</h2>
                <hr/>
                <h3>Aid Data in Context</h3>
                <p>More and more data on aid activities is available in the common <a href="http://www.iatistandard.org">Petroleum Environment Capacity enhancement Project</a>, but to bring that data to life we need to take it from where it sits on the IATI Registry, and put it into context.</p>

                <h3>Context widgets, linked data</h3>
                Roll your mouse over the link to <a class="project-info-trigger" data-iati="44000-P048204">Petroleum Environment Capacity enhancement Project</a> and you should see a pop up of information all about it. We're working to add more information to these pop-ups. The information comes direct from a <a href="http://kasabi.com/dataset/iati">Linked Data version of IATI data</a>, so that more data can be integrated in future. 

                <h3>Simple embedding</h3>
                <p>To activate the tool simply add the relevent <code>data-iati</code> attribute to an element.</p>
                
                <pre class="prettyprint linenums">
&lt;a data-iati=&quot;44000-P048204&quot;&gt;
    Petroleum Environment Capacity enhancement Project
&lt;/a&gt;</pre>

                <h3>Get involved</h3>
                Find <A href="https://github.com/rhoksoton/charityviz/">the source code on GitHub</a> and get involved in developing the project further. Developed as part of RHOK Southampton - June 2012. 
            </div>
        </div>
    </div>

    <script type="application/x-underscore-template" id="project-retrieve-sparql-template">
        SELECT * WHERE { 
            activity:{{{ project_id }}} dc:title ?title;
					dc:description ?description;
					iati:recipientCountry ?recipientCountry;
					iati:activityWebsiteUrl ?webSite;
					iati:contactInfoOrganisation ?contactInfo.
			?contactInfo dc:title ?contactTitle;
					iati:contactInfoEmail ?contactEmail;
					iati:contactInfoPerson ?contactPerson;
					iati:contactInfoPhone ?contactPhone;
					iati:contactInfoAddress ?contactAddress.
        } 
    </script>

	<script type="text/x-handlebars-template" id="participant-retrieve-sparql-template">
		SELECT ?participantTitle WHERE { 
			activity:{{{ project_id }}} iati:participatingOrg ?participating.
			?participating rdfs:seeAlso ?actualParticipant.
			?participating iati:participatingOrgRole "Implementing".
			?actualParticipant dc:title ?participantTitle.
		}
	</script>

	<script type="text/x-handlebars-template" id="provider-retrieve-sparql-template">
	SELECT DISTINCT ?provider ?title WHERE {
		?trans iati:providerOrg ?provider FILTER(!regex(str(?provider), "^http://data.kasabi.com/dataset/iati/org/$")).
		?provider dc:title ?title.
		activity:{{{ project_id }}} iati:transaction ?trans .
	}
	</script>

	<script type="text/x-handlebars-template" id="receiver-retrieve-sparql-template">
	SELECT DISTINCT ?receiver ?title WHERE {
		?trans iati:receiverOrg ?receiver FILTER(!regex(str(?receiver), "^http://data.kasabi.com/dataset/iati/org/$")).
		?receiver dc:title ?title.
		activity:{{{ project_id }}} iati:transaction ?trans .
	}
	</script>
    
	<script type="text/x-handlebars-template" id="transaction-retrieve-sparql-template">        
        SELECT * WHERE {    
          activity:{{{ project_id }}} iati:transaction ?trans .
          ?trans iati:value ?value;
                 iati:valueCurrency ?valueCurrency;
                 iati:transactionIsoDate ?date;
                 dc:description ?description;
                 iati:providerOrg ?providerOrg;
                 iati:receiverOrg ?receiverOrg.
          {
            select ?providerTitle where {
              activity:{{{ project_id }}} iati:transaction ?trans .
              ?trans iati:providerOrg ?providerOrg .
              ?providerOrg dc:title ?providerTitle . } LIMIT 1
          }
          
          {
            select ?receiverTitle where {
              activity:{{{ project_id }}} iati:transaction ?trans .
              ?trans iati:receiverOrg ?receiverOrg .
              ?recieverOrg dc:title ?receiverTitle . } LIMIT 1
          }
        }
    </script>

    <script type="text/x-handlebars-template" id="project-view-template">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">Ã—</button>
            <h3 class="project-name">{{ title }} <small class="charity-name">{{ organisation }}</small></h3>
        </div>
        <div class="modal-body">
        		{{#if transactions}}
            <table class="table table-striped transactions-table">
            	<thead>
            		<tr>
            			<th>Incoming</th>
            			<th></th>
            			<th>Outgoing</th>
            		</tr>
            	</thead>
            	<tbody>
            		{{#each transactions}}
	            		{{#if this.receiver}}
	            			<tr>
		            			<td class="td0"></td>
		            			<td class="td1"><div class="left-arrow"></div></td>
		            			<td class="td2"><b>{{this.receiver}}</b><br><small>{{this.description}}</small></td>
		            		</tr>
	            		{{else}}
										<tr>
		            			<td class="td0"><b>{{this.provider}}</b><br><small>{{this.description}}</small></td>
		            			<td class="td1"><div class="right-arrow"></div></td>
		            			<td class="td2"></td>
		            		</tr>
	            		{{/if}}
            		{{/each}}
            	</tbody>
            </table>
            {{/if}}
            <hr/>
            <p><small>{{ description }}</small></p>
        </div>
    </script>

    <script type="text/x-handlebars-template" id="project-popover-template">
	    <div id="map{{id}}" class="map"></div>
        <div class="popover-content-container">
        	{{ description }}
        </div>
    </script>

    <script>
        $(function() {
            $('.project-info-trigger').projectViz('http://api.kasabi.com/dataset/iati/apis/sparql?apikey=92912a588c30a6617ac21a69412b9a22f7f6e34d');
        });
    </script>

    <script src="js/projectviz.js"></script>
</body>
</html>
